<div class="list-container">
  <aside class="sidebar">
    <h2>Chamados</h2>

    <div class="search-box">
      <input
        type="text"
        placeholder="Buscar por OS, Contribuinte, Cidade ou Data..."
        [(ngModel)]="filtro"
        (input)="filtrarTickets()"
      />
      <button class="btn-buscar"><i class="fas fa-search"></i> Buscar</button>
    </div>

    <div class="export-buttons">
      <button class="btn-export btn-pdf" (click)="exportToPDF()">
        <i class="fas fa-file-pdf"></i> PDF
      </button>

      <button class="btn-export btn-excel" (click)="exportToExcel()">
        <i class="fas fa-file-excel"></i> Excel
      </button>
    </div>

    <ul class="ticket-list">
      <li
        *ngFor="let ticket of ticketsPaginados"
        [class.active]="ticket === ticketSelecionado"
        (click)="selecionarTicket(ticket)"
      >
        <strong>OS:</strong> {{ ticket.os }} <br />
        <small>{{ ticket.dataDoPedido | date : "dd/MM/yyyy" }}</small>

        <div class="acoes">
          <button
            class="btn-editar"
            (click)="editarTicket(ticket); $event.stopPropagation()"
          >
            <i class="fas fa-edit"></i> Editar
          </button>
          <button
            class="btn-excluir"
            (click)="confirmarExclusao(ticket); $event.stopPropagation()"
          >
            <i class="fas fa-trash"></i> Excluir
          </button>
        </div>
      </li>
    </ul>

    <div class="paginacao" *ngIf="ticketsFiltrados.length > itensPorPagina">
      <button
        (click)="paginaAtual = paginaAtual - 1"
        [disabled]="paginaAtual === 1"
      >
        Anterior
      </button>
      <span>Página {{ paginaAtual }}</span>
      <button
        (click)="paginaAtual = paginaAtual + 1"
        [disabled]="paginaAtual * itensPorPagina >= ticketsFiltrados.length"
      >
        Próxima
      </button>
    </div>

    <button routerLink="/home" class="btn-voltar">Voltar</button>
  </aside>

  <main
    class="ticket-detalhes"
    *ngIf="ticketSelecionado; else nenhumSelecionado"
  >
    <h2>Detalhes do Chamado</h2>

    <div class="detalhes-card">
      <div>
        <strong>Contribuinte:</strong> {{ ticketSelecionado.contribuinte }}
      </div>
      <div><strong>Rua:</strong> {{ ticketSelecionado.rua }}</div>
      <div><strong>Bairro:</strong> {{ ticketSelecionado.bairro }}</div>
      <div><strong>Cidade:</strong> {{ ticketSelecionado.cidade }}</div>
      <div><strong>CEP:</strong> {{ ticketSelecionado.cep }}</div>
      <div><strong>Telefone:</strong> {{ ticketSelecionado.telefone }}</div>
      <div>
        <strong>Data do Pedido:</strong>
        {{ ticketSelecionado.dataPedido | date : "dd/MM/yyyy" }}
      </div>
      <div>
        <strong>Status:</strong>
        <span class="status"> {{ ticketSelecionado.statusDoPedido }} </span>
      </div>
    </div>
  </main>
  <ng-template #nenhumSelecionado>
    <div class="placeholder">
      <i class="fas fa-info-circle"></i>
      <p>Selecione um Chamado na lista para ver os detalhes.</p>
    </div>
  </ng-template>

  <div class="toast" *ngIf="mensagem">{{ mensagem }}</div>

  <div class="modal-overlay" *ngIf="ticketParaExcluir">
    <div class="modal">
      <h3>Confirmar exclusão</h3>
      <p>
        Tem certeza que deseja excluir a OS
        <strong>{{ ticketParaExcluir.os }}</strong
        >?
      </p>
      <div class="modal-actions">
        <button class="btn-confirm" (click)="excluirTicket()">
          Sim, excluir
        </button>
        <button class="btn-cancel" (click)="ticketParaExcluir = null">
          Cancelar
        </button>
      </div>
    </div>
  </div>
</div>
